# テストクラス設計方針（TaskControllerTestベース）

本ドキュメントは、`TaskControllerTest`の実装方針をもとに、今後のテストクラス設計・実装の指針をまとめたものです。

---

## 1. テスト構造・クラス設計

- **テスト対象ごとに@Nestedクラスでグルーピング**
  - 各メソッド単位で`@Nested`クラスを作成し、正常系・異常系・例外系を明示的に分離する。
  - テストクラス全体に`@DisplayName`を付与し、テストの意図を明確化する。

- **テストメソッドの命名・DisplayName**
  - メソッド名は`testXXX`形式とし、@DisplayNameで日本語による説明を付与する。
  - パラメータライズドテストでは`@ParameterizedTest(name = "{index}: ...")`で個々のケースの説明を補足する。

## 2. テストデータ・ユーティリティ

- **テストデータ生成用のファクトリメソッドを用意**
  - テスト用のエンティティ生成は`TaskFactory`等のユーティリティクラスで一元化し、可読性・再利用性を高める。

- **テストデータは動的生成を活用**
  - 日付等は`LocalDate.now()`を基準に動的生成し、テストの柔軟性・将来の保守性を担保する。

## 3. モック・スタブの活用

- **依存コンポーネントはMockitoでモック化**
  - リポジトリ等の依存はMockitoでモックし、テスト対象のロジックのみを検証する。
  - `when(...).thenReturn(...)`や`doNothing().when(...)`等で振る舞いを制御。

## 4. テスト観点・網羅性

- **正常系・異常系・例外系を網羅**
  - 正常系だけでなく、異常系（不正パラメータ等）や例外系（存在しないID等）もパラメータライズドテストや個別テストで網羅的に検証する。

- **境界値テストの徹底**
  - 進捗率や遅延リスク等の計算系は、0件・全件・一部のみ該当・null混在などの境界値をパラメータライズドテストで網羅。

## 5. アサーション・例外検証

- **assertEquals, assertTrue, assertThrows等で明確に検証**
  - 戻り値・リスト内容・例外発生有無など、期待値を明確にアサートする。

## 6. テストデータ管理

- **テストデータは原則コード内で生成**
  - 外部ファイルに依存せず、テストクラス内で完結するデータ生成を基本とする。

---

## 7. テスト記述スタイル（AAAパターン）

- **AAAパターン（Arrange-Act-Assert）に従う**
  - 各テストメソッドは「Arrange（準備）→Act（実行）→Assert（検証）」の順で記述すること。
  - 各セクションを空行やコメント等で明確に分離し、可読性・保守性を高める。
  - 例：
    ```java
    @Test
    void testSomething() {
        // Arrange: テストデータやモックの準備

        // Act: テスト対象メソッドの実行

        // Assert: 結果の検証
    }
    ```

## 参考：TaskControllerTestでの具体例

- `calculateProgressRate`/`calculateDelayRiskRate`はパラメータライズドテストで境界値・null混在を網羅
- `add`/`update`/`addSubtask`は正常系・異常系・例外系を分離し、パラメータライズドテストで不正パラメータを網羅
- モックリポジトリの振る舞いを個別に制御し、依存を排除
- テストデータ生成は`TaskFactory`で一元化

---

## 今後のテストクラス実装指針

- 本方針に従い、テストクラスは
  - 構造化された@Nestedクラス
  - DisplayNameによる意図の明示
  - パラメータライズドテストによる網羅性
  - モック・ファクトリの活用
  - 境界値・例外系の徹底
  を重視して実装すること。
